# üîß Google Workspace SMTP Setup for Supabase Auth

**Generated by:** `researcher-permanent` + `docs-permanent` + `integrator-permanent` agents
**Date:** 2025-10-02
**Project:** ContractorAI2

---

## ‚ö†Ô∏è CRITICAL 2025 UPDATE

**Starting May 1, 2025**, Google Workspace no longer supports "less secure apps" access. You **MUST** use **App Passwords** (not your regular password).

---

## üìã Prerequisites

- ‚úÖ Google Workspace account (admin access)
- ‚úÖ 2FA enabled on your Google account
- ‚úÖ Supabase project access
- ‚úÖ Project reference: `ujhgwcurllkkeouzwvgk`

---

## üöÄ Step-by-Step Setup Guide

### **Step 1: Enable 2FA on Google Account**

1. Go to https://myaccount.google.com/
2. Navigate to **Security**
3. Enable **2-Step Verification** (2FA)
4. Complete the setup process

‚ö†Ô∏è **Note:** Enable 2FA on your personal account, NOT in the admin console.

---

### **Step 2: Create Google App Password**

1. Go to https://myaccount.google.com/apppasswords
2. Click **Create** or **Generate App Password**
3. Select:
   - **App:** Mail
   - **Device:** Other (Custom name)
   - Name it: "Supabase Auth - ContractorAI2"
4. Click **Generate**
5. **SAVE THE PASSWORD** - you'll need it in Step 4

Example app password: `abcd efgh ijkl mnop` (16 characters with spaces)

---

### **Step 3: Get Your Google Workspace Email**

Use your Google Workspace admin email as the sender.

Example: `admin@yourdomain.com` or `noreply@yourdomain.com`

---

### **Step 4: Configure Supabase Custom SMTP**

#### **Option A: Via Supabase Dashboard (Recommended)**

**Method 1 - Direct URL (Fastest):**
1. Go directly to: https://supabase.com/dashboard/project/ujhgwcurllkkeouzwvgk/auth/smtp

**Method 2 - Manual Navigation:**
1. Go to: https://supabase.com/dashboard/project/ujhgwcurllkkeouzwvgk
2. In left sidebar, click: **Authentication** (üîê icon)
3. Click: **Email Templates** tab at the top
4. Scroll down to find: **SMTP Settings** section
5. Toggle **Enable Custom SMTP** to ONth

**Enter the following:**

```
SMTP Host: smtp.gmail.com
SMTP Port: 587 (or 465 for SSL)
SMTP Username: your-admin@yourdomain.com
SMTP Password: [paste your app password here - remove spaces]
Sender Email: your-admin@yourdomain.com
Sender Name: ContractorAI (optional)
```

5. Click **Save**

#### **Option B: Via Environment Variables (Self-Hosted)**

Add to your Supabase config or `.env`:

```bash
SMTP_ADMIN_EMAIL=your-admin@yourdomain.com
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-admin@yourdomain.com
SMTP_PASS=your_app_password_here
SMTP_SENDER_NAME=ContractorAI
```

---

### **Step 5: SMTP Server Options**

You have **two** Google SMTP options:

#### **Option 1: smtp.gmail.com (Recommended)**
```
Host: smtp.gmail.com
Port: 587 (TLS) or 465 (SSL)
‚úÖ Works with both ports
‚úÖ Standard Gmail SMTP
```

#### **Option 2: smtp-relay.gmail.com (Google Workspace Only)**
```
Host: smtp-relay.gmail.com
Port: 465 (SSL ONLY)
‚ö†Ô∏è Only port 465 works
‚ö†Ô∏è Google Workspace accounts only
```

**Recommendation:** Use `smtp.gmail.com` with port `587` for best compatibility.

---

### **Step 6: Test Email Sending**

1. Open the diagnostic tool: `/Users/mikahalbertson/git/ContractorAI/contractorai2/tests/test-email-auth.html`
2. Or use this quick test:

```bash
cd /Users/mikahalbertson/git/ContractorAI/contractorai2
npm run dev
```

3. Try signing up with a test email
4. Check if confirmation email arrives

---

## üîç Troubleshooting

### **Issue: "Invalid credentials" error**

**Solution:**
- ‚úÖ Verify 2FA is enabled
- ‚úÖ Use App Password (not regular password)
- ‚úÖ Remove spaces from app password
- ‚úÖ Use your Google Workspace admin email

### **Issue: "Connection timeout"**

**Solution:**
- ‚úÖ Try port 587 instead of 465
- ‚úÖ Verify firewall isn't blocking SMTP
- ‚úÖ Check Google Workspace SMTP relay is enabled

### **Issue: "Authentication failed"**

**Solution:**
- ‚úÖ Regenerate app password
- ‚úÖ Ensure email matches SMTP username exactly
- ‚úÖ Check for typos in credentials

### **Issue: Emails not sending**

**Solution:**
- ‚úÖ Check Google Workspace sending limits (2000/day)
- ‚úÖ Verify sender email is verified in Google
- ‚úÖ Check Supabase logs for errors
- ‚úÖ Test with gmail.com address first

---

## üìä Google Workspace SMTP Limits

| Limit Type | Amount |
|------------|--------|
| Daily sending limit | 2,000 emails/day |
| Rate limit | ~100 emails/hour |
| Recipients per email | 500 |
| Email size | 25 MB |

For higher limits, consider using **SendGrid**, **Resend**, or **AWS SES**.

---

## üîê Security Best Practices

1. **Use dedicated service account**
   - Create `noreply@yourdomain.com` for automated emails
   - Don't use your personal admin account

2. **Rotate app passwords regularly**
   - Change every 90 days
   - Revoke old passwords

3. **Monitor sending activity**
   - Check Google Workspace logs
   - Watch for suspicious activity

4. **Use specific app passwords**
   - One app password per service
   - Label clearly: "Supabase - ContractorAI2"

---

## ‚úÖ Verification Checklist

- [ ] 2FA enabled on Google account
- [ ] App password generated and saved
- [ ] Custom SMTP configured in Supabase
- [ ] Test email sent successfully
- [ ] Email confirmation working
- [ ] Sender email verified
- [ ] Credentials stored securely

---

## üÜò Still Having Issues?

**Contact Support:**
- Supabase Support: https://supabase.com/support
- Google Workspace Support: https://support.google.com/a

**Check Logs:**
```bash
# Supabase logs
supabase functions logs

# Check Supabase dashboard
https://supabase.com/dashboard/project/ujhgwcurllkkeouzwvgk/logs
```

---

## üìö Additional Resources

- [Google Workspace SMTP Relay](https://support.google.com/a/answer/2956491)
- [Supabase Custom SMTP Docs](https://supabase.com/docs/guides/auth/auth-smtp)
- [Google App Passwords](https://support.google.com/accounts/answer/185833)

---

**Generated by Persistent Hivemind Swarm**
**Session:** persistent-session-contractorai2
